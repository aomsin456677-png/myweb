<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3D Survival Shooter</title>
<style>
body { margin:0; overflow:hidden; }
#ui{
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  font-family:sans-serif;
}
</style>
</head>
<body>

<div id="ui">
‚ù§Ô∏è HP: <span id="hp">100</span><br>
üèÜ Score: <span id="score">0</span>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ‡πÅ‡∏™‡∏á
let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,7);
scene.add(light);

// ‡∏û‡∏∑‡πâ‡∏ô
let groundGeo = new THREE.PlaneGeometry(200,200);
let groundMat = new THREE.MeshLambertMaterial({color:0x228B22});
let ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
for(let i=0;i<20;i++){
  let trunk = new THREE.Mesh(
    new THREE.CylinderGeometry(0.5,0.5,3),
    new THREE.MeshLambertMaterial({color:0x8B4513})
  );
  trunk.position.set(
    (Math.random()-0.5)*100,
    1.5,
    (Math.random()-0.5)*100
  );
  scene.add(trunk);

  let leaves = new THREE.Mesh(
    new THREE.SphereGeometry(2),
    new THREE.MeshLambertMaterial({color:0x006400})
  );
  leaves.position.set(trunk.position.x,4,trunk.position.z);
  scene.add(leaves);
}

// ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
camera.position.y = 2;
let hp = 100;
let score = 0;

let keys = {};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

// ‡∏®‡∏±‡∏ï‡∏£‡∏π
let enemies = [];

function spawnEnemy(){
  let enemy = new THREE.Mesh(
    new THREE.BoxGeometry(2,2,2),
    new THREE.MeshLambertMaterial({color:0xff0000})
  );
  enemy.position.set(
    (Math.random()-0.5)*100,
    1,
    (Math.random()-0.5)*100
  );
  scene.add(enemy);
  enemies.push(enemy);
}
setInterval(spawnEnemy,3000);

// ‡∏¢‡∏¥‡∏á
document.addEventListener("click", ()=>{
  let raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
  let intersects = raycaster.intersectObjects(enemies);

  if(intersects.length>0){
    scene.remove(intersects[0].object);
    enemies.splice(enemies.indexOf(intersects[0].object),1);
    score++;
    document.getElementById("score").innerText=score;
  }
});

// ‡πÄ‡∏Å‡∏°‡∏•‡∏π‡∏õ
function animate(){
  requestAnimationFrame(animate);

  // ‡πÄ‡∏î‡∏¥‡∏ô
  if(keys["w"]) camera.position.z -= 0.5;
  if(keys["s"]) camera.position.z += 0.5;
  if(keys["a"]) camera.position.x -= 0.5;
  if(keys["d"]) camera.position.x += 0.5;

  // ‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏≤‡πÄ‡∏£‡∏≤
  enemies.forEach(enemy=>{
    let dir = new THREE.Vector3();
    dir.subVectors(camera.position,enemy.position).normalize();
    enemy.position.add(dir.multiplyScalar(0.1));

    if(enemy.position.distanceTo(camera.position)<1.5){
      hp -= 1;
      document.getElementById("hp").innerText=hp;
      if(hp<=0){
        alert("Game Over! Score: "+score);
        location.reload();
      }
    }
  });

  renderer.render(scene,camera);
}

animate();
</script>

</body>
</html>
