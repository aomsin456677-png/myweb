<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3D Survival Battle</title>
<style>
body { margin:0; overflow:hidden; }
#ui{
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  font-family:sans-serif;
  z-index:10;
}
#crosshair{
  position:absolute;
  top:50%;
  left:50%;
  width:20px;
  height:20px;
  margin-left:-10px;
  margin-top:-10px;
  border:2px solid white;
  border-radius:50%;
  z-index:10;
}
</style>
</head>
<body>

<div id="ui">
‚ù§Ô∏è HP: <span id="hp">100</span><br>
üèÜ Score: <span id="score">0</span>
</div>

<div id="crosshair"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
scene.add(light);

// Ground
let ground = new THREE.Mesh(
  new THREE.PlaneGeometry(300,300),
  new THREE.MeshLambertMaterial({color:0x2e8b57})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// House
let house = new THREE.Mesh(
  new THREE.BoxGeometry(10,6,10),
  new THREE.MeshLambertMaterial({color:0x8b4513})
);
house.position.set(20,3,-20);
scene.add(house);

// Trees
let obstacles = [];
for(let i=0;i<25;i++){
  let tree = new THREE.Mesh(
    new THREE.CylinderGeometry(1,1,5),
    new THREE.MeshLambertMaterial({color:0x654321})
  );
  tree.position.set(
    (Math.random()-0.5)*200,
    2.5,
    (Math.random()-0.5)*200
  );
  scene.add(tree);
  obstacles.push(tree);
}

// Player
camera.position.set(0,2,0);
let hp = 100;
let score = 0;

let keys = {};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

// Enemies
let enemies = [];
function spawnEnemy(){
  let enemy = new THREE.Mesh(
    new THREE.BoxGeometry(2,2,2),
    new THREE.MeshLambertMaterial({color:0xff0000})
  );
  enemy.position.set(
    (Math.random()-0.5)*200,
    1,
    (Math.random()-0.5)*200
  );
  scene.add(enemy);
  enemies.push(enemy);
}
setInterval(spawnEnemy,4000);

// Shooting
document.addEventListener("click", ()=>{
  let raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
  let intersects = raycaster.intersectObjects(enemies);

  if(intersects.length>0){
    let hit = intersects[0].object;
    scene.remove(hit);
    enemies.splice(enemies.indexOf(hit),1);
    score++;
    document.getElementById("score").innerText=score;
  }
});

// Game loop
function animate(){
  requestAnimationFrame(animate);

  let speed = 0.5;

  if(keys["w"]) camera.position.z -= speed;
  if(keys["s"]) camera.position.z += speed;
  if(keys["a"]) camera.position.x -= speed;
  if(keys["d"]) camera.position.x += speed;

  enemies.forEach(enemy=>{
    let dir = new THREE.Vector3();
    dir.subVectors(camera.position,enemy.position).normalize();
    enemy.position.add(dir.multiplyScalar(0.1));

    if(enemy.position.distanceTo(camera.position)<1.5){
      hp -= 1;
      document.getElementById("hp").innerText=hp;
      if(hp<=0){
        alert("Game Over! Score: "+score);
        location.reload();
      }
    }
  });

  renderer.render(scene,camera);
}
animate();
</script>

</body>
</html>
